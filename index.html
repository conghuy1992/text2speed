<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>English Word Reader</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          BlinkMacSystemFont,
          sans-serif;
        padding: 24px;
        max-width: 600px;
        margin: auto;
      }

      textarea {
        width: 100%;
        height: 120px;
        font-size: 16px;
        padding: 12px;
        box-sizing: border-box;
      }

      .row {
        margin-top: 12px;
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
      }

      input[type="number"] {
        width: 120px;
        padding: 8px;
        font-size: 16px;
      }

      label {
        display: flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
      }

      button {
        margin-top: 16px;
        padding: 12px 20px;
        font-size: 16px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h2>English Word Reader</h2>

    <textarea
      id="input"
      placeholder="apple, banana, orange"
      oninput="saveData()"
    ></textarea>

    <div class="row">
      <label>
        Interval (seconds):
        <input
          id="interval"
          type="number"
          min="0"
          step="0.5"
          value="2"
          oninput="saveData()"
        />
      </label>

      <label>
        <input id="repeat" type="checkbox" onchange="saveData()" />
        Repeat
      </label>
    </div>

    <button onclick="readWords()">▶ Read</button>
    <button onclick="stopReading()">⏹ Stop</button>

    <script>
      const STORAGE_KEY = "english_word_reader_data";
      let isStopped = false;

      // ✅ LOAD saved data
      window.addEventListener("DOMContentLoaded", () => {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (!saved) return;

        try {
          const data = JSON.parse(saved);
          document.getElementById("input").value = data.text || "";
          document.getElementById("interval").value = data.interval ?? 2;
          document.getElementById("repeat").checked = data.repeat ?? false;
        } catch {}
      });

      // ✅ SAVE data
      function saveData() {
        const data = {
          text: document.getElementById("input").value,
          interval: document.getElementById("interval").value,
          repeat: document.getElementById("repeat").checked,
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }

      function readWords() {
        const rawText = document.getElementById("input").value;
        const intervalSeconds = parseFloat(
          document.getElementById("interval").value,
        );
        const repeat = document.getElementById("repeat").checked;

        const delayMs = Math.max(intervalSeconds, 0) * 1000;

        const words = rawText
          .split(",")
          .map((w) => w.trim())
          .filter(Boolean);

        if (words.length === 0) return;

        isStopped = false;
        speechSynthesis.cancel();

        speakWords(words, delayMs, repeat);
      }

      function speakWords(words, delayMs, repeat) {
        let index = 0;

        function speakNext() {
          if (isStopped) return;

          // ✅ hết danh sách
          if (index >= words.length) {
            if (repeat) {
              index = 0;
              setTimeout(speakNext, delayMs);
            }
            return;
          }

          const utterance = new SpeechSynthesisUtterance(words[index]);
          utterance.lang = "en-US";
          utterance.rate = 0.9;

          utterance.onend = () => {
            index++;
            setTimeout(speakNext, delayMs);
          };

          speechSynthesis.speak(utterance);
        }

        speakNext();
      }

      function stopReading() {
        isStopped = true;
        speechSynthesis.cancel();
      }
    </script>
  </body>
</html>
